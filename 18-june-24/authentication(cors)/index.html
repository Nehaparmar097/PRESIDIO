<!DOCTYPE html>
<html>
<head>
    <title>Product Details</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script>
        const clickButton = () => {
            alert('Button Clicked');
            const txtUid = document.getElementById('txtUid').value;
            const txtPass = document.getElementById('txtPass').value;

            fetch('http://localhost:5190/api/User/Login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    "email": txtUid,  // Ensure this matches your API's expected field name
                    "password": txtPass
                })
            })
            .then(res => {
                if (!res.ok) {
                    return res.json().then(err => {throw new Error(err.title || 'Login failed');});
                }
                return res.json();
            })
            .then(data => {
                console.log(data);
                localStorage.setItem('token', data.token);
                GetAllUsers();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Login failed: ' + error.message);
            });
        }

        const GetAllUsers = () => {
            const token = localStorage.getItem('token');
            if (!token) {
                alert('No token found, please login first.');
                return;
            }

            fetch('http://localhost:5190/api/User/GetAllUsers', {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token,
                },
            })
            .then(res => {
                if (!res.ok) {
                    return res.json().then(err => {throw new Error(err.title || 'Unauthorized');});
                }
                return res.json();
            })
            .then(data => {
                console.log(data);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to fetch users: ' + error.message);
            });
        }

        const updateUserEmail = () => {
            const userId = document.getElementById('userId').value;
            const newEmail = document.getElementById('newEmail').value;
            const token = localStorage.getItem('token');
            const url = `http://localhost:5190/api/User/UpdateUserEmail?id=${userId}&email=${encodeURIComponent(newEmail)}`;

            fetch(url, {
                method: 'PUT',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Content-Type': 'application/json',
                }
            })
            .then(res => {
                if (!res.ok) {
                    return res.json().then(err => {throw new Error(err.title || 'Update failed');});
                }
                return res.json();
            })
            .then(data => {
                console.log(data);
                document.getElementById('divMessage').innerHTML = `<div class="alert alert-success">Email updated successfully</div>`;
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('divMessage').innerHTML = `<div class="alert alert-danger">Failed to update email: ${error.message}</div>`;
            });
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>Product Details</h1>
        <div class="mb-3">
            <input type="file" id="fileInput" name="fileInput">
        </div>
        <div class="mb-3">
            <input class="form-control" type="email" id="txtUid" placeholder="Enter your email" required />
        </div>
        <div class="mb-3">
            <input class="form-control" type="password" id="txtPass" placeholder="Enter your password" required />
        </div>
        <div class="mb-3">
            <button class="btn btn-success" onclick="clickButton()">Login</button>
        </div>
        <h2>Update User Email</h2>
        <div class="mb-3">
            <input class="form-control" type="text" id="userId" placeholder="Enter user ID" required />
        </div>
        <div class="mb-3">
            <input class="form-control" type="email" id="newEmail" placeholder="Enter new email" required />
        </div>
        <div class="mb-3">
            <button class="btn btn-primary" onclick="updateUserEmail()">Update Email</button>
        </div>
        <div id="divMessage"></div>
    </div>
</body>
</html>
